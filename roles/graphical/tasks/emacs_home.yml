---
- name: Clone ~/.emacs.d/
  become: yes
  become_user: "{{ username }}"
  git:
    repo: ssh://git@github.com/kylerjohnston/emacs.d.git
    dest: /home/{{ username }}/.emacs.d
    accept_hostkey: yes

- name: Create ~/.local/share/applications
  file:
    path: /home/{{ username }}/.local/share/applications
    state: directory
    owner: "{{ username }}"
    group: "{{ username }}"
    recurse: yes
    mode: 0700

- name: Create ~/.local/share/applications/emacsclient.desktop
  copy:
    src: emacsclient.desktop
    dest: /home/{{ username }}/.local/share/applications/emacsclient.desktop
    owner: "{{ username }}"
    group: "{{ username }}"
    mode: 0664
 
- name: Create local emacs service
  copy:
    src: emacs.service
    dest: /home/{{ username }}/.config/systemd/user/emacs.service
    owner: "{{ username }}"
    group: "{{ username }}"
    mode: 0664

- name: Enable emacs service
  systemd:
    name: emacs
    state: started
    enabled: yes
    scope: user
    daemon_reload: yes
  become: yes
  become_user: "{{ username }}"
